# 四则运算数据集生成器说明文档

## 1. 简介

本项目提供一个Python脚本 (`generate_arithmetic_dataset.py`)，用于自动生成包含加、减、乘法和括号的随机四则运算表达式数据集。生成的数据集包含问题（表达式字符串）和答案（计算结果），并以JSON格式保存，非常适合用于机器学习模型的训练、算法测试或其他需要数学表达式数据的场景。

## 2. 功能特性

* **合法的表达式**：所有生成的表达式都保证语法正确，可以直接进行计算。
* **多样化的结构**：通过递归和随机组合，可以生成从简单到复杂的嵌套表达式，例如 `(a + b) * c` 或 `a - (b * (c + d))`。
* **可控的复杂度**：用户可以通过设置表达式中**操作数（数字）**的最小和最大数量来控制表达式的整体长度和复杂度。
* **问答对形式**：每个数据样本都包含 `question` (问题) 和 `answer` (答案) 两个字段。
* **JSON格式输出**：数据集以易于解析和使用的JSON格式存储。

## 3. 如何使用

### 先决条件

* 安装 Python 3.x。
* 无需安装任何第三方库，脚本仅使用Python内置的 `random` 和 `json` 模块。

### 运行脚本

1. 将上面的代码保存为 `generate_arithmetic_dataset.py` 文件。
2. 打开该文件，在文件底部的 `if __name__ == '__main__':` 部分修改配置参数：

   * `MIN_OPERANDS`：设置表达式中最少包含的操作数（数字）数量，建议不小于2。
   * `MAX_OPERANDS`：设置表达式中最多包含的操作数（数字）数量。
   * `NUM_SAMPLES`：你希望生成的数据样本总数。
   * `OUTPUT_FILE`：输出的JSON文件名。
3. 打开终端或命令行工具，导航到脚本所在的目录，然后运行：

   ```bash

   python generate_arithmetic_dataset.py

   ```
4. 脚本运行后，会显示生成进度，并在完成后于同一目录下创建一个名为 `arithmetic_dataset.json` (或你指定的文件名) 的文件。

## 4. 代码逻辑解析

### `ArithmeticExpressionGenerator` 类

这是负责生成表达式的核心类。

#### `__init__(self, min_operands, max_operands)`

构造函数初始化表达式的复杂度范围。它将 `min_operands` 和 `max_operands` 作为参数，这定义了每个算式中数字的个数范围。

#### `_generate_recursive(self, num_operands)`

这是最关键的函数，它采用**递归**的方式构建表达式树。

- **基本情况**: 当需要生成的部分只包含1个操作数时，函数直接返回一个随机生成的数字字符串。
- **递归步骤**: 当需要生成的部分包含多个操作数时，函数执行以下操作：

  1. 将当前需要操作数的数量 `num_operands` 随机地**一分为二**，分成 `left_operands` 和 `right_operands`。
  2. **递归调用**自身，为左右两部分分别生成子表达式 `left_expr` 和 `right_expr`。
  3. 选择一个随机的运算符 (`+`, `-`, `*`)。
  4. 将左右子表达式和运算符拼接起来，形成 `left_expr operator right_expr` 的结构。
  5. 为了增加多样性，如果一个子表达式本身也比较复杂（操作数大于1），脚本会以50%的概率为它**加上括号**。

这种递归分裂的方法确保了生成的表达式总是有正确的二元运算结构，并且能自然地产生嵌套括号。

#### `generate_expression(self)`

这个公共方法负责生成一个完整的表达式和答案。

1. 首先在 `[min_operands, max_operands]` 范围内随机选择一个确切的操作数数量。
2. 调用 `_generate_recursive()` 来生成表达式字符串。
3. 使用Python内置的 `eval()` 函数计算表达式的结果。由于表达式是由我们自己的安全逻辑生成的，因此在这里使用 `eval()` 是安全的，不会有代码注入的风险。
4. 返回问题（表达式）和答案组成的元组。

### `create_dataset()` 函数

这个函数负责整个数据集的创建流程。

1. 接收一个生成器实例、要生成的样本数和输出路径。
2. 在一个循环中，不断调用生成器的 `generate_expression()` 方法来获取问答对。
3. 将每个问答对存为一个字典 `{"question": ..., "answer": ...}`，并添加到列表中。
4. 当达到指定数量后，使用 `json.dump()` 将整个列表写入到目标JSON文件中，并使用 `indent=4` 参数使其格式化，便于阅读。

## 5. 输出文件格式

最终生成的JSON文件是一个包含多个对象的列表。每个对象代表一个问答样本，结构如下：

```json

[

    {

        "question": "81 - (12 * 3)",

        "answer": 45

    },

    {

        "question": "(69 + 8) * (91 - 23)",

        "answer": 5236

    },

    {

        "question": "42 + 55 - 19",

        "answer": 78

    },

    ...

]
```
